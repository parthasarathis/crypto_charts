<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crypto Candlestick Viewer — GitHub Pages</title>
  <!-- Lightweight Charts (TradingView style) -->
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa7bf;
      --accent:#60a5fa;
      --surface:#071124;
      --radius:12px;
      color-scheme: dark;
    }
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(180deg,#061021 0%, #071124 100%);color:#e6eef8;padding:20px;box-sizing:border-box}

    .app{max-width:1100px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    header h1{font-size:18px;margin:0}
    .controls{display:flex;gap:10px;align-items:center}
    input[type=text]{padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;width:160px}
    button{padding:9px 14px;border-radius:10px;border:0;background:var(--accent);color:#071124;font-weight:600;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}

    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:var(--radius);box-shadow:0 6px 18px rgba(2,6,23,0.6);min-height:320px}
    .card h2{margin:0 0 6px 0;font-size:14px;color:var(--muted)}
    .chart-container{height:320px}

    .footer{margin-top:16px;color:var(--muted);font-size:13px}
    .status{margin-left:12px;color:var(--muted);font-size:13px}
    .notice{padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Crypto Candlestick Viewer — GitHub Pages</h1>
      <div class="controls">
        <label for="symbol" style="display:none">Symbol</label>
        <input id="symbol" type="text" value="BTCUSDT" placeholder="Symbol (e.g. BTCUSDT)">
        <button id="loadBtn">Load</button>
        <button id="exampleBtn" class="secondary">Examples</button>
        <span id="status" class="status">Ready</span>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <h2>Last 4 Weekly candles (4 weeks)</h2>
        <div id="chart-week" class="chart-container"></div>
      </div>

      <div class="card">
        <h2>Last 28 Daily candles (28 days)</h2>
        <div id="chart-day" class="chart-container"></div>
      </div>

      <div class="card" style="grid-column:1/-1">
        <h2>Last 112 4-hour candles</h2>
        <div id="chart-4h" class="chart-container"></div>
      </div>
    </div>

    <div class="footer">
      <div class="notice">Data source: Binance public REST API — <strong>no API key required</strong> for klines. The site is static and suitable for GitHub Pages. If you hit rate limits, wait a few seconds and retry.</div>
    </div>
  </div>

  <script>
    // ---------- Utility functions ----------
    const el = id => document.getElementById(id);
    const setStatus = (s) => { el('status').textContent = s };

    // Validate symbol (basic check)
    function validateSymbol(sym){
      if(!sym) return false;
      // Binance symbols are alphanumeric, typically uppercase, no spaces
      return /^[A-Za-z0-9]{5,12}$/.test(sym);
    }

    // Fetch klines from Binance
    async function fetchKlines(symbol, interval, limit){
      const base = 'https://api.binance.com/api/v3/klines';
      const url = `${base}?symbol=${symbol}&interval=${interval}&limit=${limit}`;
      const resp = await fetch(url);
      if(!resp.ok){
        const text = await resp.text();
        throw new Error(`Binance fetch failed: ${resp.status} ${resp.statusText} ${text}`);
      }
      const data = await resp.json();
      // Binance kline format: [ openTime, open, high, low, close, volume, closeTime, ... ]
      return data.map(k => ({
        time: Math.floor(k[0]/1000), // epoch seconds — compatible with Lightweight Charts
        open: parseFloat(k[1]),
        high: parseFloat(k[2]),
        low: parseFloat(k[3]),
        close: parseFloat(k[4])
      }));
    }

    // ---------- Chart rendering helpers ----------
    function createChart(container){
      // Keep charts responsive by letting library detect container size; we'll re-create on window resize if needed
      const chart = LightweightCharts.createChart(container, {
        width: container.clientWidth,
        height: container.clientHeight,
        layout: { backgroundColor: 'transparent', textColor: '#e6eef8' },
        grid: { vertLines: { color: 'rgba(255,255,255,0.03)' }, horzLines: { color: 'rgba(255,255,255,0.02)' } },
        timeScale: { timeVisible: true, secondsVisible: false }
      });
      const series = chart.addCandlestickSeries({ upColor: '#26a69a', downColor: '#ef5350', borderVisible: false, wickVisible: true });
      return { chart, series };
    }

    // Keep chart instances so we can update data
    const charts = {
      week: null,
      day: null,
      h4: null
    };

    function resizeCharts(){
      Object.values(charts).forEach(c => {
        if(!c) return;
        const container = c.chart._internal__layout._domElement; // internal access to container — fallback
        try{
          c.chart.applyOptions({ width: container.clientWidth, height: container.clientHeight });
        }catch(e){/* ignore */}
      });
    }

    window.addEventListener('resize', () => { setTimeout(resizeCharts,120) });

    // ---------- Main flow ----------
    async function loadAll(symbol){
      const s = symbol.toUpperCase();
      if(!validateSymbol(s)){
        setStatus('Invalid symbol format');
        return;
      }

      setStatus('Fetching data...');

      // Create charts if not created
      if(!charts.week){ charts.week = createChart(el('chart-week')); }
      if(!charts.day){ charts.day = createChart(el('chart-day')); }
      if(!charts.h4){ charts.h4 = createChart(el('chart-4h')); }

      try{
        // fetch in parallel
        const [weekData, dayData, h4Data] = await Promise.all([
          fetchKlines(s, '1w', 4),
          fetchKlines(s, '1d', 28),
          fetchKlines(s, '4h', 112)
        ]);

        // set data
        charts.week.series.setData(weekData);
        charts.day.series.setData(dayData);
        charts.h4.series.setData(h4Data);

        setStatus('Data loaded — last update: ' + new Date().toLocaleString());
      }catch(err){
        console.error(err);
        setStatus('Error: ' + (err.message || 'fetch failed'));
      }
    }

    // ---------- Interaction ----------
    el('loadBtn').addEventListener('click', ()=>{
      const sym = el('symbol').value.trim();
      loadAll(sym);
    });

    el('exampleBtn').addEventListener('click', ()=>{
      const examples = ['BTCUSDT','ETHUSDT','BNBUSDT','SOLUSDT'];
      const next = examples[Math.floor(Math.random()*examples.length)];
      el('symbol').value = next; setStatus('Example: ' + next);
    });

    // Auto-load default on first render
    window.addEventListener('load', ()=>{ loadAll(el('symbol').value.trim()); });

    // ---------- Notes for deployers ----------
    // 1) This is a static site. Put this single file at the root of a public GitHub repo and enable GitHub Pages (main branch -> / (root)).
    // 2) Binance rate limits: public endpoints have limits. If you plan to add auto-refresh or more symbols concurrently, add server-side caching or a proxy.
    // 3) For production-grade projects consider:
    //    - Adding volume overlays
    //    - Adding timezone selector
    //    - Using a small caching layer (Cloudflare Workers) to avoid CORS or rate limits
    //    - Providing fallback or mock data when API refuses

  </script>
</body>
</html>